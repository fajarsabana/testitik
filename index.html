<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Point Grouping Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .marker-label {
            background-color: white;
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid #aaa;
            font-size: 10px;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div id="controls">
    <label for="group">Select Group:</label>
    <select id="group">
        <option value="A">Polygon A</option>
        <option value="B">Polygon B</option>
        <option value="C">Polygon C</option>
    </select>
    <button onclick="exportGeoJSON()">Export GeoJSON</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

  const points = [
  [107.1229806, -6.3284111],
  [107.1234167, -6.3243667],
  [107.1253417, -6.32565],
  [107.1234167, -6.3243667],
  [107.1168278, -6.3218222],
  [107.1134861, -6.3192778],
  [107.112075, -6.3208139],
  [107.111, -6.3211306],
  [107.1105056, -6.3228722],
  [107.1105667, -6.32363],
  [107.1104833, -6.32525],
  [107.1083611, -6.3247306],
  [107.1073528, -6.3269639],
  [107.1056472, -6.3263528],
  [107.1041917, -6.32865],
  [107.1033917, -6.3282],
  [107.1033139, -6.328775],
  [107.1036222, -6.331975],
  [107.1031306, -6.3315833],
  [107.1028806, -6.3313111],
  [107.1029333, -6.332175],
  [107.1023528, -6.3337167],
  [107.1034583, -6.3343528],
  [107.1046167, -6.3345389],
  [107.1070222, -6.3347194],
  [107.1067361, -6.3359167],
  [107.1073833, -6.3362722],
  [107.1081583, -6.3366833],
  [107.1089833, -6.3374278],
  [107.1109722, -6.3378472],
  [107.11165, -6.3377917],
  [107.1124111, -6.3385194],
  [107.1137778, -6.3398778],
  [107.1165667, -6.341925],
  [107.1178333, -6.3354611],
  [107.1192778, -6.3324167],
  [107.1216472, -6.3280083],
  [107.1224667, -6.3268389],
  [107.121875, -6.3263528],
];

   
    const map = L.map('map').setView([-6.29, 107.12], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 20,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const groupColors = { A: 'red', B: 'blue', C: 'green' };
    const pointMarkers = [];
    const groupedPoints = { A: [], B: [], C: [] };

    points.forEach((point, index) => {
        const marker = L.marker([point[1], point[0]], { draggable: false }).addTo(map);
        marker.bindTooltip(`${index + 1}`, {
            permanent: true,
            direction: 'top',
            className: 'marker-label'
        }).openTooltip();
        marker.index = index;
        marker.group = null;
        marker.on('click', function () {
            const selectedGroup = document.getElementById('group').value;
            if (this.group) {
                // Remove from previous group
                groupedPoints[this.group] = groupedPoints[this.group].filter(m => m.index !== this.index);
            }
            this.group = selectedGroup;
            this.setIcon(new L.Icon.Default({
                iconUrl: `https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=${this.index+1}|${groupColors[selectedGroup].replace('#','')}`
            }));
            groupedPoints[selectedGroup].push(this);
        });
        pointMarkers.push(marker);
    });

    function exportGeoJSON() {
        const features = [];
        for (const group in groupedPoints) {
            if (groupedPoints[group].length > 2) {
                const coords = groupedPoints[group].map(m => [m.getLatLng().lng, m.getLatLng().lat]);
                coords.push(coords[0]); // Close the polygon
                features.push({
                    type: 'Feature',
                    properties: { group },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [coords]
                    }
                });
            }
        }

        const geojson = {
            type: 'FeatureCollection',
            features
        };

        const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'grouped_polygons.geojson';
        a.click();
        URL.revokeObjectURL(url);
    }
</script>

</body>
</html>
