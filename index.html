<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Point Grouping Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .marker-label {
            background-color: white;
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid #aaa;
            font-size: 10px;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div id="controls">
    <label for="group">Select Group:</label>
    <select id="group">
        <option value="A">Polygon A</option>
        <option value="B">Polygon B</option>
        <option value="C">Polygon C</option>
    </select>
    <button onclick="exportGeoJSON()">Export GeoJSON</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
   const points = [
    [107.11957777777778, -6.2924999999999995],
    [107.11958055555554, -6.287086111111111],
    [107.12338888888888, -6.287227777777778],
    [107.12341388888888, -6.280208333333333],
    [107.12409444444444, -6.275022222222222],
    [107.13284444444444, -6.273036111111111],
    [107.13442500000001, -6.270402777777778],
    [107.13786666666667, -6.269225],
    [107.13884722222222, -6.267011111111111],
    [107.14017777777778, -6.266847222222222],
    [107.14168055555557, -6.263911111111111],
    [107.14478333333334, -6.263480555555556],
    [107.14604444444446, -6.267761111111111],
    [107.14592222222223, -6.270533333333333],
    [107.14818611111112, -6.2705222222222226],
    [107.14831666666667, -6.273263888888889],
    [107.15021111111112, -6.274211111111111],
    [107.14945, -6.274872222222222],
    [107.1483638888889, -6.275477777777778],
    [107.14916944444445, -6.280175],
    [107.15145277777778, -6.283672222222222],
    [107.14996666666667, -6.286297222222222],
    [107.1523138888889, -6.286436111111111],
    [107.15229166666667, -6.2889083333333335],
    [107.14708055555556, -6.293577777777777],
    [107.14727777777779, -6.295736111111111],
    [107.14246666666668, -6.296772222222222],
    [107.14165000000001, -6.297722222222222],
    [107.13841944444445, -6.2949472222222225],
    [107.14859166666668, -6.294183333333333],
    [107.1219861111111, -6.293372222222222],
    [107.14765555555556, -6.295661111111111],
    [107.14706944444445, -6.297136111111111],
    [107.14630555555556, -6.300016666666666],
    [107.14757222222222, -6.3045277777777775],
    [107.1514638888889, -6.310561111111111],
    [107.15860555555557, -6.313541666666667],
    [107.16064722222222, -6.310694444444445],
    [107.16379444444445, -6.310463888888889],
    [107.16511666666668, -6.309061111111111],
    [107.16510833333334, -6.304055555555555],
    [107.16068055555556, -6.3040666666666665],
    [107.1606388888889, -6.300252777777778],
    [107.15922777777779, -6.299738888888888],
    [107.1590138888889, -6.297266666666666],
    [107.15460277777778, -6.297336111111111],
    [107.15463333333334, -6.296819444444444],
    [107.15249722222222, -6.296833333333333],
    [107.15282222222223, -6.294538888888889],
    [107.15218333333334, -6.278113888888889],
    [107.15587777777779, -6.275686111111111],
    [107.16768055555556, -6.259336111111111],
    [107.14713888888889, -6.258966666666667],
    [107.14719166666667, -6.262130555555555],
    [107.14741111111111, -6.264647222222222],
    [107.14843611111112, -6.270041666666667],
    [107.15047777777778, -6.274444444444445],
];

    const map = L.map('map').setView([-6.29, 107.12], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 20,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const groupColors = { A: 'red', B: 'blue', C: 'green' };
    const pointMarkers = [];
    const groupedPoints = { A: [], B: [], C: [] };

    points.forEach((point, index) => {
        const marker = L.marker([point[1], point[0]], { draggable: false }).addTo(map);
        marker.bindTooltip(`${index + 1}`, {
            permanent: true,
            direction: 'top',
            className: 'marker-label'
        }).openTooltip();
        marker.index = index;
        marker.group = null;
        marker.on('click', function () {
            const selectedGroup = document.getElementById('group').value;
            if (this.group) {
                // Remove from previous group
                groupedPoints[this.group] = groupedPoints[this.group].filter(m => m.index !== this.index);
            }
            this.group = selectedGroup;
            this.setIcon(new L.Icon.Default({
                iconUrl: `https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=${this.index+1}|${groupColors[selectedGroup].replace('#','')}`
            }));
            groupedPoints[selectedGroup].push(this);
        });
        pointMarkers.push(marker);
    });

    function exportGeoJSON() {
        const features = [];
        for (const group in groupedPoints) {
            if (groupedPoints[group].length > 2) {
                const coords = groupedPoints[group].map(m => [m.getLatLng().lng, m.getLatLng().lat]);
                coords.push(coords[0]); // Close the polygon
                features.push({
                    type: 'Feature',
                    properties: { group },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [coords]
                    }
                });
            }
        }

        const geojson = {
            type: 'FeatureCollection',
            features
        };

        const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'grouped_polygons.geojson';
        a.click();
        URL.revokeObjectURL(url);
    }
</script>

</body>
</html>
