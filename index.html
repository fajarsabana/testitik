<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Point Grouping Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .marker-label {
            background-color: white;
            padding: 2px 4px;
            border-radius: 4px;
            border: 1px solid #aaa;
            font-size: 10px;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            z-index: 1000;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div id="controls">
    <label for="group">Select Group:</label>
    <select id="group">
        <option value="A">Polygon A</option>
        <option value="B">Polygon B</option>
        <option value="C">Polygon C</option>
    </select>
    <button onclick="exportGeoJSON()">Export GeoJSON</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

    const points = [
    [107.11327499999999, -6.318347222222222],
    [107.11744444444444, -6.317138888888889],
    [107.12285555555555, -6.315255555555555],
    [107.12815555555555, -6.319136111111111],
    [107.11759166666666, -6.316858333333333],
    [107.11870833333333, -6.313747222222222],
    [107.12942222222222, -6.322066666666666],
    [107.12642222222222, -6.322413888888889],
    [107.12641944444444, -6.324313888888889],
    [107.12530277777778, -6.3219916666666665],
    [107.12387777777776, -6.323536111111111],
    [107.11917222222222, -6.322188888888888],
    [107.15139444444445, -6.3537027777777775],
    [107.1491888888889, -6.356933333333333],
    [107.14521388888889, -6.354647222222222],
    [107.14397777777778, -6.356536111111111],
    [107.14175555555556, -6.358486111111111],
    [107.1384388888889, -6.356902777777777],
    [107.13768055555556, -6.354058333333333],
    [107.13345833333334, -6.353886111111111],
    [107.1321, -6.355627777777777],
    [107.12825833333332, -6.359047222222222],
    [107.12671666666667, -6.363402777777777],
    [107.12143888888889, -6.367241666666667],
    [107.11807777777777, -6.3713999999999995],
    [107.11463888888888, -6.370119444444444],
    [107.11793888888889, -6.371780555555556],
    [107.12276666666666, -6.371727777777777],
    [107.12355277777777, -6.376569444444444],
    [107.12970277777777, -6.373244444444444],
    [107.13270555555555, -6.374694444444444],
    [107.1333111111111, -6.371819444444444],
    [107.13751111111112, -6.3699611111111105],
    [107.13565833333334, -6.363297222222222],
    [107.13615, -6.358380555555555],
    [107.13558888888889, -6.362488888888889],
    [107.1486388888889, -6.364238888888888],
    [107.15511944444445, -6.371616666666666],
    [107.16023333333334, -6.370724999999999],
    [107.16129722222223, -6.3731527777777774],
    [107.16312500000001, -6.3696777777777775],
    [107.16482500000001, -6.367008333333333],
    [107.1671388888889, -6.36245],
    [107.1712, -6.356030555555555],
    [107.17552222222223, -6.3586472222222215],
    [107.17907777777778, -6.357125],
    [107.17923055555556, -6.3553138888888885],
    [107.17993333333334, -6.353944444444444],
    [107.18024444444445, -6.351438888888889],
    [107.17539722222223, -6.350330555555555],
    [107.12804722222222, -6.349977777777777],
    [107.17875000000001, -6.341783333333333],
    [107.17895833333334, -6.338925],
    [107.17865833333333, -6.335794444444444],
    [107.16248333333334, -6.328216666666666],
    [107.16150555555556, -6.331541666666666],
    [107.1592388888889, -6.336530555555555],
    [107.16118611111112, -6.337777777777777],
    [107.16338611111112, -6.340230555555555],
    [107.16712222222223, -6.344636111111111],
    [107.16689444444445, -6.346511111111111],
    [107.17434444444444, -6.348158333333333],
    [107.17255277777778, -6.3501361111111105],
    [107.09130555555555, -6.315941666666666],
    [107.16666944444445, -6.355916666666666],
    [107.16474722222223, -6.355811111111111],
    [107.15804722222222, -6.353513888888888],
    [107.15833611111111, -6.359672222222222],
    [107.15319722222223, -6.314891666666666],
    [107.16009722222223, -6.320377777777778],
    [107.15431944444445, -6.322891666666666],
    [107.15549444444444, -6.320352777777778],
    [107.15184722222223, -6.321355555555555],
];
    
   
    const map = L.map('map').setView([-6.29, 107.12], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 20,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const groupColors = { A: 'red', B: 'blue', C: 'green' };
    const pointMarkers = [];
    const groupedPoints = { A: [], B: [], C: [] };

    points.forEach((point, index) => {
        const marker = L.marker([point[1], point[0]], { draggable: false }).addTo(map);
        marker.bindTooltip(`${index + 1}`, {
            permanent: true,
            direction: 'top',
            className: 'marker-label'
        }).openTooltip();
        marker.index = index;
        marker.group = null;
        marker.on('click', function () {
            const selectedGroup = document.getElementById('group').value;
            if (this.group) {
                // Remove from previous group
                groupedPoints[this.group] = groupedPoints[this.group].filter(m => m.index !== this.index);
            }
            this.group = selectedGroup;
            this.setIcon(new L.Icon.Default({
                iconUrl: `https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=${this.index+1}|${groupColors[selectedGroup].replace('#','')}`
            }));
            groupedPoints[selectedGroup].push(this);
        });
        pointMarkers.push(marker);
    });

    function exportGeoJSON() {
        const features = [];
        for (const group in groupedPoints) {
            if (groupedPoints[group].length > 2) {
                const coords = groupedPoints[group].map(m => [m.getLatLng().lng, m.getLatLng().lat]);
                coords.push(coords[0]); // Close the polygon
                features.push({
                    type: 'Feature',
                    properties: { group },
                    geometry: {
                        type: 'Polygon',
                        coordinates: [coords]
                    }
                });
            }
        }

        const geojson = {
            type: 'FeatureCollection',
            features
        };

        const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'grouped_polygons.geojson';
        a.click();
        URL.revokeObjectURL(url);
    }
</script>

</body>
</html>
